# 知识库 Bug 记录与分析系统 - 设计与规划 (最终版)

## 1. 愿景与目标 (Vision & Goals)

### 1.1 愿景
构建一个**内部 Bug 档案库**，它深度集成于知识库中。通过记录 Bug 的核心信息及其每一次发生的时间点，将静态的知识文档转变为能够揭示系统质量问题模式与趋势的动态分析平台。

### 1.2 核心目标
- **归档 (Archive)**: 在本系统内独立、完整地记录每个唯一 Bug 的档案信息（是什么问题）。
- **记录日志 (Log Occurrences)**: 对每一个已归档的 Bug，精确记录其**每一次**发生的时间和相关信息，形成可供分析的时间序列数据。
- **关联 (Link)**: 建立 Bug 档案与一个或多个知识模块的清晰关联，反映问题的影响范围。
- **分析 (Analyze)**: 基于 Bug 档案及其详细的发生日志，量化评估各模块的稳定性，并进行趋势和频率分析。

---

## 2. 核心数据模型 (Core Data Models)

此方案的核心是分离“Bug 的定义”和“Bug 的发生实例”，采用两个核心模型和一个关联模型。

### 2.1 `bug_profile` 模型 (Bug 档案)
此模型代表一个**唯一的 Bug 类型**，是问题的“档案”或“卷宗”。

| 字段名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `id` | Integer | 主键，唯一标识。 |
| `title` | String | Bug 的简明扼要的标题。 |
| `description` | Rich Text | 详细描述，支持图文、代码块、复现步骤。 |
| `severity` | Enum | **严重程度** (`CRITICAL`, `HIGH`, `MEDIUM`, `LOW`)，核心分析指标。 |
| `tags` | Array/JSON | 自定义标签，用于灵活分类 (如 `UI`, `Backend`, `Performance`)。 |
| `reporter_id` | ForeignKey (User) | **首次**将此 Bug 归档的用户。 |
| `created_at` | DateTime | 档案创建时间（即 Bug 首次被记录的时间）。 |

### 2.2 `bug_log` 模型 (发生日志)
此模型代表 Bug 的**每一次具体发生**，与 `bug_profile` 是一对多的关系。

| 字段名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `id` | Integer | 主键。 |
| `bug_id` | ForeignKey (bug_profile) | 关联到唯一的 `bug_profile` 档案，表明“发生的是哪个 Bug”。 |
| `occurred_at` | DateTime | **核心字段**。本次发生的精确时间戳。 |
| `reporter_id` | ForeignKey (User) | 报告**本次**发生的用户。 |
| `notes` | Text | (可选) 关于本次发生的任何补充说明。 |

### 2.3 `bug_module_link` 模型 (关联表)
此中间表用于连接 `bug_profile` (Bug 档案) 和 `ModuleStructureNode`，实现多对多关联。

| 字段名 | 类型 | 描述 |
| :--- | :--- | :--- |
| `module_id` | ForeignKey (ModuleStructureNode) | 关联的模块 ID。 |
| `bug_id` | ForeignKey (bug_profile) | 关联的 Bug 档案 ID。 |
| `manifestation_description`| Text | (可选) 描述该 Bug 在此模块下的特定表现。|

---

## 3. 核心机制与工作流程

### 3.1 创建缺陷档案 (主要流程)
1.  用户进入工作区级的 **“缺陷管理”** 页面。
2.  点击“新建缺陷档案”，系统打开一个独立的创建表单。
3.  用户填写 `bug_profile` 的核心信息（标题、描述、严重性等）。表单中包含一个 **“关联模块”** 的字段（如树形选择器或搜索框）。
4.  用户在表单中直接指定一个或多个需要关联的知识模块。
5.  提交后，系统执行以下操作：
    *   创建一条新的 `bug_profile` 记录。
    *   **自动**为这个新 `bug_profile` 创建其**第一条** `bug_log` 记录。
    *   根据用户在表单中的选择，在 `bug_module_link` 中创建一条或多条关联记录。

### 3.2 记录一次新的发生 (Log an Occurrence)
此操作的核心是为**已存在**的 `bug_profile` 增加一条 `bug_log`。
1.  用户在任何关联了该 `bug_profile` 的模块页面，或在“缺陷管理”中心，找到目标 `bug_profile`。
2.  点击“报告一次新的发生”或类似按钮。
3.  系统**只创建一个新的 `bug_log` 记录**，关联到该 `bug_profile`，并记录当前时间和报告人。

### 3.3 关联一个已存在的缺陷
1.  用户在【模块 B】页面，发现一个现象，并认为它与一个**已存在但尚未关联**的缺陷是同一个问题。
2.  点击“关联已有问题”。
3.  UI 提供一个搜索界面，让用户在**整个缺陷库**中查找 `bug_profile` 档案。
4.  用户选定目标 `bug_profile` 后，系统只在 `bug_module_link` 表中创建一条新的关联记录，将【模块 B】与该 `bug_profile` 连接起来。

---

## 4. 用户界面与工作流程 (UI/UX & Workflow)

### 4.1 缺陷管理中心
- **位置**: 在工作区级的“数据资源”菜单下，与接口、数据库等资源同级，建立一个全新的 **“缺陷管理”** 页面。
- **核心功能**:
    - **统一视图**: 提供一个可搜索、可筛选、可排序的表格或列表，集中展示工作区内**所有**的 `bug_profile` 档案。
    - **核心指标**: 列表项应直观展示关键信息，如标题、严重性、状态、**总发生次数**和最近发生时间。
    - **主要操作**: 用户可在此页面执行**创建新缺陷**、查看缺陷详情、编辑缺陷档案等核心操作。

### 4.2 模块页集成
在每个知识模块的内容页面，原有的 **“关联缺陷记录 (Linked Defects)”** 区域功能更新。

- **主视图与展开视图**: 保持不变。列表展示与本模块关联的 `bug_profile`，并可展开查看详情和发生历史。
- **操作按钮 (更新)**:
    - **“关联已有问题”**: 核心操作。弹出一个搜索框或选择器，允许用户从“缺陷管理中心”的完整列表中查找并关联一个或多个 `bug_profile` 到当前模块。
    - **“报告一次新的发生”**: 针对列表中已关联的某个 `bug_profile`，快速为其添加一条 `bug_log`。
    - **“记录新问题 (快捷方式)”**: 此按钮作为快捷入口，点击后**跳转到“缺陷管理中心”的创建页面**，并自动将当前模块预先填入“关联模块”字段。

---

## 5. 数据分析与价值 (Data Analysis & Value)

这个数据模型为深度分析提供了坚实基础。

### 5.1 模块健康分 (Module Health Score)
可以设计更动态的健康分算法，**侧重于近期问题**。
**示例公式**: `Score = 100 - (近期 CRITICAL 发生次数 * 5) - (近期 HIGH 发生次数 * 2) - (近期 MEDIUM 发生次数 * 1)`
*“近期”可以定义为过去30天。*

### 5.2 趋势与频率分析
- **问题发生频率图**: 绘制图表，展示某个特定 Bug 或全部 Bug 的 `bug_log` 数量随时间（按天/周/月）的变化。这能清晰地看出问题是在恶化、改善还是具有周期性。
- **新 Bug 引入速率**: 监控新 `bug_profile` 档案的创建速率，评估版本质量。

### 5.3 洞察与决策支持
- **识别“最痛”问题**: 排序 `bug_log` 数量最多的 `bug_profile`，可以识别出对用户影响最频繁的问题，即使其单次严重性不高。
- **评估修复效果**: 在发布一个修复补丁后，观察其对应的 `bug_profile` 的 `bug_log` 增长曲线是否变平缓，可以量化地评估修复是否有效。
